default:
  tags:
    - softwaredevelopment02

image: $DOCKER_IMAGE
services:
  - name: $DOCKER_IMAGE
    command:
      [
        "--insecure-registry=10.200.137.252:8082",
        "--insecure-registry=10.200.137.252:8083",
      ]

stages:
  - unittest
  - build

variables:  
  DOCKER_TLS_CERTDIR: ""
  DOCKER_DRIVER: overlay2
  DOCKER_HOST: tcp://localhost:2375
  DOCKER_IMAGE: "docker:19.03.3-dind"

  PROJECT_NAME: "python-prototype"
  ACR_LOGIN_SERVER: "replatformpoc.azurecr.io"
  
  PROJECT_IMAGE_NAME: "$ACR_LOGIN_SERVER/$PROJECT_NAME"
  PROJECT_IMAGE_VERSION: "$CI_PIPELINE_IID"

  ACR_USERNAME: RePlatformPOC
  ACR_PASSWORD: /w0KyIYW=KJEzeWGHwcl21zsxWofPUYG

  ASP_LOGIN_USER: a51ee474-acca-4f39-bf90-d5f2de5b2f40
  ASP_LOGIN_PASSWORD: UVBvN1F+NmNIbFNtMkE4MVU4VWNWNVBzU2ZuQU0uZ35IQ05KUQ==

  ACR_NAME: replatformpoc


# Rules for only develop and except master/main
.only-develop:
  only:
    - develop
  except:
    - main
    - master
# Rules for only tag
.only-tags:
  only:
    - tags    

include:
  - /build/ci/unittest.yml
  - /build/ci/build-docker-global.yml


