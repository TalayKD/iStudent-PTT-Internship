# Security & Smoke Test
.test-smoke:
  image: $DOCKER_IMAGE
  services:
    - name: $DOCKER_IMAGE
      command: ["--insecure-registry=10.200.137.252:8082", "--insecure-registry=10.200.137.252:8083"]
  allow_failure: false
  variables:
    APPLICATION: "$PROTOCOL://$HOST_NAME"
  script:
    - apk add --no-cache tzdata
    - TZ=Asia/Bangkok date +'%d/%m/%Y %H:%M:%S'
    - echo "Security Smoke Testing"
    - echo "APPLICATION = $APPLICATION"
    - docker run --rm 
      -e TZ=Asia/Bangkok
      -e ROBOT_OPTIONS="--variable APPLICATION:$APPLICATION"
      -e BROWSER=chrome 
      -v ${PWD}/tests/robots:/opt/robotframework/tests:Z 
      -v ${PWD}/tests/robots/reports:/opt/robotframework/reports:Z 
      --user $(id -u):$(id -g) 
      ppodgorsek/robot-framework:3.8.0
  after_script:
    - ls -lrt ${PWD}/tests/robots/reports
